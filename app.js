const axios = require('axios');
const express = require('express');
const app = express();
const fs = require('fs');
require('dotenv').config()
const Busquedas = require("./models/busqueda");
const Personas = require("./models/Personas");
const Agregar = require("./models/Agregar");
const AddData = require('./models/AddData');
const { guardarDB } = require('./models/Guardar');
const ConversionSheet = require('./helpers/excelConvert');
const LeerDocumentos = require('./models/LeerDocumentos');

const port = process.env.PORT; //process.env.PORT cuando el puerto es dinamico

//Routing
// app.get('/', (req, res) => {
//     res.send('Mi servidor online');
//     res.end();
// });
const main = async () => {

        //Array de documentos
        const new_documents = new LeerDocumentos();
        const doc = new_documents.readDB();

        const documents = [
                '05001787',
                '10650047',
                '10700932',
                '10749299',
                '10807020',
                '10880538',
                '15283794',
                '15351275',
                '15426020',
                '44448974',
                '15704857',
                '15742966',
                '15745895',
                '15848790',
                '15853177',
                '15864156',
                '16006975',
                '16155930',
                '16683739',
                '17452399',
                '19092038',
                '19546577',
                '20026437',
                '20030820',
                '20068321',
                '20077892',
                '20104794',
                '20595375',
                '21528065',
                '22993801',
                '23100134',
                '23212535',
                '23271278',
                '23569985',
                '23860881',
                '23964707',
                '23965469',
                '24956917',
                '07150997',
                '46606574',
                '25464190',
                '25645765',
                '25733160',
                '25760307',
                '25785650',
                '25816147',
                '25847732',
                '28065886',
                '29315074',
                '29429889',
                '29608972',
                '29653624',
                '29707476',
                '30505833',
                '30836524',
                '31680398',
                '31889219',
                '32032784',
                '32043051',
                '32045747',
                '32108216',
                '32132139',
                '32137005',
                '32260863',
                '32404296',
                '72262054',
                '32798360',
                '32878886',
                '32915153',
                '32961292',
                '32992515',
                '33342821',
                '40043421',
                '40051832',
                '40059913',
                '40085773',
                '40099275',
                '40140605',
                '40152068',
                '40186500',
                '40205687',
                '40223606',
                '40240981',
                '40246750',
                '40289699',
                '40291961',
                '40297695',
                '40314520',
                '40417696',
                '40421621',
                '40426865',
                '40442053',
                '40501573',
                '40612617',
                '40638298',
                '40658124',
                '40682365',
                '40682609',
                '40694859',
                '40703164',
                '40725892',
                '40768395',
                '40790791',
                '40814235',
                '40824526',
                '40886454',
                '40888083',
                '40903267',
                '40947576',
                '41016909',
                '41091184',
                '41132905',
                '41191508',
                '41220751',
                '41283266',
                '41342574',
                '41344246',
                '00555564',
                '40215650',
                '40522238',
                '40621258',
                '43477300',
                '40777773',
                '40826583',
                '40875100',
                '40976904',
                '41087511',
                '41221321',
                '41260739',
                '41320824',
                '41327926',
                '41345615',
                '41366046',
                '41374973',
                '41388436',
                '41390478',
                '41468563',
                '41530930',
                '41655101',
                '41663699',
                '41714261',
                '41756826',
                '41761501',
                '41863330',
                '41950643',
                '42017038',
                '42051675',
                '42091999',
                '10426520',
                '42207472',
                '42270436',
                '42378975',
                '42501177',
                '42646129',
                '42747586',
                '42748827',
                '42824251',
                '43027016',
                '43186810',
                '43224329',
                '43308324',
                '43354984',
                '43556187',
                '43780922',
                '43790854',
                '43928052',
                '43935582',
                '43953342',
                '47419575',
                '73522249',
                '44106775',
                '44273857',
                '44280351',
                '44285149',
                '44426517',
                '44486247',
                '44526552',
                '44541355',
                '44601057',
                '44621919',
                '44669474',
                '44812323',
                '44960671',
                '45197926',
                '45330524',
                '45345506',
                '45434813',
                '48117659',
                '45486043',
                '45508990',
                '45720515',
                '45757155',
                '45981007',
                '46256202',
                '46282416',
                '46627632',
                '46733253',
                '46807197',
                '46836183',
                '47020980',
                '47159281',
                '47266610',
                '47313524',
                '47344665',
                '47491130',
                '48209494',
                '48607587',
                '48887637',
                '49003066',
                '70138431',
                '70189682',
                '70197772',
                '70244887',
                '71408472',
                '71452132',
                '72109518',
                '73027174',
                '73452335',
                '73632536',
                '74730910',
                '75115667',
                '75153420',
                '75426035',
                '76806145',
                '76843380',
                '77028710',
                '77278426',
                '80257055',
                '80667864',
                '47136577',
                '42055539',
                '70016635',
                '00505884',
                '00683349',
                '07989537',
                '08864769',
                '08889477',
                '09606635',
                '09973017',
                '10107288',
                '10147345',
                '80192983',
                '10357584',
                '10425358',
                '10475165',
                '10500888',
                '09801477',
                '10621637',
                '10625791',
                '10646050',
                '10650198',
                '10719030',
                '75514208',
                '23562121',
                '24486312',
                '25750128',
                '75151130',
                '25789076',
                '28298245',
                '78421850',
                '29586787',
                '00253911',
                '03641485',
                '29686334',
                '31187906',
                '31827136',
                '32648823',
                '32884779',
                '40000270',
                '40010444',
                '40024833',
                '43219513',
                '40244997',
                '40272541',
                '40370858',
                '40412312',
                '40558820',
                '40654971',
                '40748935',
                '40837293',
                '40948671',
                '40974126',
                '41291860',
                '70271989',
                '41054109',
                '41108709',
                '48327496',
                '41268870',
                '47151435',
                '74405944',
                '45099411',
                '71156656',
                '41808463',
                '41968152',
                '41971562',
                '42137276',
                '42536430',
                '42743091',
                '42998365',
                '43083391',
                '43390488',
                '43497973',
                '43575675',
                '43748457',
                '43785496',
                '43796383',
                '43807714',
                '43830924',
                '43880614',
                '43949489',
                '44209805',
                '44289502',
                '01788241',
                '46419649',
                '44561306',
                '44809009',
                '44840406',
                '45055377',
                '45165652',
                '32647699',
                '01317294',
                '45498170',
                '45590405',
                '45591031',
                '45631678',
                '45803516',
                '45787691',
                '45822621',
                '45915424',
                '47256362',
                '46091244',
                '46101902',
                '46110131',
                '46116531',
                '46163779',
                '01317295',
                '46414429',
                '46680251',
                '48154959',
                '46822992',
                '46905138',
                '47140443',
                '47210986',
                '43889913',
                '03695051',
                '47448386',
                '00508174',
                '47830102',
                '47903080',
                '47927872',
                '48156315',
                '70142175',
                '70295704',
                '71027651',
                '71347312',
                '71422025',
                '71718906',
                '72932229',
                '72953818',
                '70181676',
                '73880819',
                '74326463',
                '45496260',
                '75824862',
                '76019999',
                '76033856',
                '76198280',
                '76661301',
                '77026498',
                '44146198',
                '44146197',
                '80622680',
                '07441389',
                '09024297',
                '09123439',
                '09908449',
                '10177862',
                '10578302',
                '10697461',
                '10776941',
                '15588973',
                '15599733',
                '20723652',
                '29564521',
                '32948505',
                '40646083',
                '40661922',
                '40856671',
                '40933585',
                '41539712',
                '41669254',
                '41797445',
                '41971405',
                '42049192',
                '42104778',
                '42750918',
                '42938616',
                '42977068',
                '43108595',
                '43172281',
                '43240793',
                '09627102',
                '43567666',
                '43575635',
                '43747940',
                '44028530',
                '44129494',
                '44133537',
                '44227405',
                '44328987',
                '44360493',
                '44415613',
                '45311196',
                '46808550',
                '46193393',
                '46303103',
                '46585223',
                '47006397',
                '46947581',
                '45153289',
                '47274340',
                '47402792',
                '70228265',
                '70422574',
                '71692899',
                '71727637',
                '75212256',
                '78421909',
                '80000158',
                '80634450',
                '00425985',
                '42055537',
                '01774523',
                '04054199',
                '07217898',
                '07473184',
                '07762226',
                '08176667',
                '08286469',
                '09616695',
                '09893990',
                '18006469',
                '25703135',
                '10169370',
                '10194778',
                '10307444',
                '40371776',
                '75851202',
                '10756357',
                '15992467',
                '16687812',
                '25624715',
                '25731505',
                '26663967',
                '27057320',
                '29559369',
                '30493701',
                '32846131',
                '33260702',
                '40045821',
                '40057446',
                '40661233',
                '40901546',
                '41106509',
                '41129470',
                '03158228',
                '10669835',
                '47428380',
                '45639168',
                '15865091',
                '16017195',
                '22521403',
                '23005510',
                '29577339',
                '30833949',
                '40439728',
                '40987856',
                '40542149',
                '47331611',
                '48101716',
                '40908474',
                '40953455',
                '41124772',
                '75402475',
                '41438135',
                '41804584',
                '07336175',
                '75667241',
                '43464521',
                '41952532',
                '46188418',
                '43288244',
                '43332938',
                '44271984',
                '43661842',
                '03695053',
                '43867751',
                '44081225',
                '44627607',
                '44884056',
                '45019028',
                '45097562',
                '45332331',
                '40098348',
                '45836002',
                '46566806',
                '05173899',
                '77472284',
                '47209028',
                '48213560',
                '48523801',
                '70437774',
                '71301881',
                '76736804',
                '46945727',
                '47621364',
                '74227714',
                '77328579',
                '02664704',
                '07080115',
                '07734122',
                '07956945',
                '09618278',
                '42774959',
                '10673787',
                '15427543',
                '46658750',
                '25580730',
                '30495211',
                '31680551',
                '32482447',
                '32926896',
                '40023533',
                '40286916',
                '40577721',
                '40642275',
                '41339567',
                '41778532',
                '41785431',
                '42694695',
                '42913965',
                '43341565',
                '43486500',
                '44123031',
                '44836499',
                '44922667',
                '45112328',
                '45653247',
                '45762187',
                '46866385',
                '70690507',
                '48128374',
                '48137857',
                '48142983',
                '71818119',
                '71741795',
                '71886529',
                '76820332',
                '76959434',
                '77160074',
                '06092482',
                '08164429',
                '08773656',
                '08871159',
                '09790386',
                '10204385',
                '10860662',
                '10876198',
                '23001143',
                '26683968',
                '40070729',
                '40265912',
                '40399404',
                '40416706',
                '41103330',
                '41320376',
                '41933738',
                '42021468',
                '42324028',
                '42452779',
                '42511191',
                '42673447',
                '43091781',
                '43122534',
                '43614310',
                '43692777',
                '44119662',
                '45496266',
                '44413635',
                '44665715',
                '42540918',
                '44799208',
                '45268367',
                '45710838',
                '46267705',
                '46929925',
                '48002339',
                '48138807',
                '73388230',
                '73707295',
                '75690370',
                '76404380',
                '07507609',
                '09049853',
                '47065909',
                '70893364',
                '09569682',
                '76098381',
                '09744967',
                '10299920',
                '15709328',
                '31626657',
                '33342277',
                '40497871',
                '41509443',
                '41547656',
                '43342005',
                '44758061',
                '45197544',
                '09443592',
                '46640539',
                '48076925',
                '08000986',
                '72430949',
                '72956504',
                '74051291',
                '76579736',
                '77141228',
                '77482005',
                '80493152',
                '00428868',
                '77279612',
                '04749730',
                '45466677',
                '05381406',
                '08663370',
                '09051555',
                '09789219',
                '44927220',
                '08000980',
                '10334295',
                '10667314',
                '72645719',
                '10875709',
                '15215664',
                '31544025',
                '40722651',
                '41313499',
                '41227133',
                '43325636',
                '43488405',
                '43556839',
                '09540134',
                '45815397',
                '47345773',
                '47753387',
                '71279003',
                '72206536',
                '72212084',
                '80516084',
                '07184189',
                '09590021',
                '15214561',
                '15735482',
                '28293377',
                '40169360',
                '40639426',
                '41038273',
                '41953834',
                '42524896',
                '42711393',
                '42938493',
                '44079984',
                '46951339',
                '45302932',
                '45677829',
                '45997316',
                '46186140',
                '46767217',
                '46863458',
                '47262806',
                '72362736',
                '47900651',
                '74065182',
                '80229551',
                '73677022',
                '10113963',
                '10627312',
                '29686043',
                '32903919',
                '22866256',
                '40332838',
                '41026673',
                '41144664',
                '42529072',
                '44071542',
                '44442640',
                '44445636',
                '44963652',
                '44969269',
                '45537708',
                '45819194',
                '46195795',
                '46924093',
                '47058824',
                '47440840',
                '47584483',
                '48337209',
                '32665432',
                '75487264',
                '03376001',
                '07113951',
                '07495790',
                '09750627',
                '09937501',
                '10003145',
                '10697473',
                '40724290',
                '41097275',
                '41242530',
                '42672215',
                '43074285',
                '44236704',
                '45789454',
                '45897505',
                '46637787',
                '75787000',
                '47863894',
                '70865618',
                '71888080',
                '77200922',
                '77811425',
                '06804817',
                '08000981',
                '10110026',
                '30000001',
                '30000002',
                '10742956',
                '10779743',
                '15734589',
                '75280313',
                '41354608',
                '41424771',
                '42755938',
                '03695052',
                '70138394',
                '43505831',
                '44067556',
                '45329499',
                '48030846',
                '76653385',
                '01870444',
                '08606905',
                '09298788',
                '09383160',
                '78005761',
                '09925445',
                '30000003',
                '04749498',
                '10612631',
                '10750504',
                '29582443',
                '40011626',
                '40697603',
                '41275627',
                '41719698',
                '42884210',
                '43152939',
                '42711117',
                '43636933',
                '43751052',
                '44255728',
                '73131518',
                '44861520',
                '45158114',
                '16867228',
                '45764505',
                '46897356',
                '48671029',
                '47564034',
                '43157057',
                '09733973',
                '42555951',
                '46406847',
                '47060781',
                '71900622',
                '79506851',
                '08000987',
                '72581163',
                '16170395',
                '32960545',
                '40307128',
                '40977444',
                '41922515',
                '44040127',
                '44172656',
                '46961241',
                '43324503',
                '76817152',
                '10133924',
                '40761565',
                '42586008',
                '10402636',
                '43321727',
                '43992256',
                '45912398',
                '47154137',
                '70336027',
                '70341220',
                '03348328',
                '16001487',
                '16688076',
                '47871597',
                '25525022',
                '40017508',
                '07408683',
                '40688200',
                '42128311',
                '16731870',
                '08000983',
                '43925377',
                '44690006',
                '45143703',
                '75527495',
                '48671027',
                '72108051',
                '47875597',
                '47701538',
                '70042442',
                '70324745',
                '76120002',
                '10631685',
                '30481406',
                '32041502',
                '32950452',
                '40186091',
                '41185790',
                '75483068',
                '10500654',
                '44383981',
                '44550920',
                '42755940',
                '46962704',
                '48776696',
                '48827857',
                '48367508',
                '06054842',
                '07460334',
                '16731875',
                '42353308',
                '48671021',
                '08922411',
                '40124162',
                '42782753',
                '43585787',
                '43790646',
                '43850544',
                '45112121',
                '46137809',
                '46149007',
                '47795503',
                '08000985',
                '25252525',
                '74065180',
                '75486897',
                '10102129',
                '15720897',
                '31666557',
                '31669170',
                '71467103',
                '42270263',
                '45619937',
                '45774840',
                '45935232',
                '47263727',
                '80146348',
                '07263459',
                '10004493',
                '10752503',
                '32984269',
                '03929374',
                '42213022',
                '45770165',
                '32646800',
                '77700804',
                '71553838',
                '20077115',
                '29657230',
                '32486228',
                '41560513',
                '47768439',
                '47945569',
                '71244702',
                '45513017',
                '30655590',
                '40074554',
                '40366627',
                '41182227',
                '47987201',
                '71567594',
                '44388577',
                '72090937',
                '80652660',
                '46597251',
                '04068791',
                '08145174',
                '10160492',
                '32647110',
                '32941151',
                '44380265',
                '75703096',
                '70338758',
                '70668389',
                '00488518',
                '29611049',
                '45496267',
                '32943682',
                '41503615',
                '41742825',
                '43569532',
                '45494568',
                '45954479',
                '72489901',
                '72570625',
                '07483072',
                '09856439',
                '26691870',
                '30962438',
                '32847760',
                '42765257',
                '26704669',
                '72174888',
                '00515510',
                '44378855',
                '32983399',
                '42780095',
                '44735028',
                '45268839',
                '46266739',
                '43485681',
                '72165945',
                '72564689',
                '09531484',
                '31679262',
                '40626969',
                '43037909',
                '46923396',
                '09922357',
                '29639211',
                '41721813',
                '42625828',
                '46874145',
                '72410042',
                '41344627',
                '07502932',
                '44018040',
                '30303030',
                '76423302',
                '10036039',
                '25847202',
                '45496268',
                '45496262',
                '46874067',
                '47770416',
                '48306281',
                '45496261',
                '77188615',
                '10507981',
                '24890150',
                '47612241',
                '32894862',
                '04085105',
                '41126428',
                '41158664',
                '41754853',
                '71220331',
                '43635803',
                '45466717',
                '48071145',
                '76589998',
                '05257241',
                '09371900',
                '15844625',
                '31617727',
                '40024995',
                '43527332',
                '45387134',
                '04419062',
                '40327614',
                '10083624',
                '10666524',
                '40204057',
                '45661931',
                '45517917',
                '75409074',
                '45830084',
                '10381849',
                '48041985',
                '48126425',
                '04065522',
                '06039773',
                '40611193',
                '09445577',
                '07507737'

        ];
        //Instanciar api         
        const busquedas = new Busquedas();
        const add = new AddData();
        let data = add.listadoArr;

        try {
                //buscar resultado
                for (const document of documents) {
                        const info_dni = await busquedas.infoDocumento(document);
                        //Obtener resultado
                        const { id, apellido_paterno, apellido_materno, nombres, fecha_nacimiento } = info_dni;

                        //agregar datos a un objeto
                        const persona = new Personas(id, apellido_paterno, apellido_materno, nombres, fecha_nacimiento);
                        add.crearData(persona);
                        data.push(persona);
                }

                const excel = new ConversionSheet();
                guardarDB(data);
                excel.leerDB();
                console.log("Proceso culminado");
        } catch (error) {
                console.log(error);
        }



}

// const LeerDocumentos = require('./models/LeerDocumentos');

// function main2() {
//       const datos = new LeerDocumentos();
//       const data = datos.leerDB();
//       console.log(data);

// }

// main2();

main();
//Puerto Listen
// app.listen(port, () => {
//     console.log(`El servidor está corriendo en el puerto ${port}`);
// });

















